# O365-Outlook-OAuth2-Tools
Utilities for working with O365 Outlook and OAuth2

To use o365-token-saver.pl:
1. Create an application in your AAD environment, and note the client ID and Client secret
2. Install Perl (On Windows, use Strawberry Perl)
3. Install the Chilkat library
4. Create a directory to work in, and download the code to it
5. Alter the code to include your Chilkat license key
6. Create a `.o365` directory under the work directory
7. Create the file `_nn_-config.json` in the `.o365` directory based on the `00-config.json` file in this repo
8. Replace all of the placeholders in that file with the appropirate values from your environment
9. Run `o365-token-saver.pl` with the `_nn_` from step 7 as the only command-line parameter
10. When the browser opens, enter the email address and password
11. If this is the first time using this account with this application, you will also need to grant the application the requested permissions
12. If you complete the sign-on within 30 seconds, the browser will display a success message
13. The access token has been saved as `.o365\_nn_-token.json`

To use img-eng-email.pl.patch.o365:

On a system with a recent version of /usr/bin/img-eng-email.pl, use the command `patch -p0 < img-eng-email.pl.patch.o365` to alter it to invoke img-eng-email-o365.pl for message download when `cnf_Email_Import.cei_Options` contains the `365` flag.

To use img-eng-email-o365.pl:

1. Place it in the `/var/imaging/bin/` directory with appropirate ownereship and permission
2. Create the `/home/mailer/.o365` directory, with RWX permissions for the imaging group
3. Place the `_nn_-config.json` file used with `o365-token-saver.pl` in the directory created in step 2
4. Place the `_nn_-token.json` file generated by `o365-token-saver.pl` in the directory created in step 2
5. `psql images -c "UPDATE cnf_Email_Import SET cei_Options = cei_Options || ' 365' WHERE cei_Sequence = _nn_;"`
6. Optional: `su mailer` and run it manually with `/var/imaging/bin/img-eng-email-o365.pl _nn_`
7. Check `/var/log/imaging/mailer` to see if it is working




